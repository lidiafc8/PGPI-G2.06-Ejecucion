{% extends 'base_admin.html' %} 
{% load static %}

{% block title %}Gestión de Pedidos{% endblock %}

{% block breadcrumbs %}
    </li>
    <li>
        <span class="text-lg text-gray-500">></span>
        <span class="text- font-medium text-gray-500 hover:text-[#bf7149]">
            PEDIDOS
        </span>
    </li>
{% endblock breadcrumbs %}

{% block content %}
<h1 class="text-3xl font-extrabold text-black mb-4 md:mb-0">Gestión de Pedidos</h1>
<hr class="mb-8"> 

<div class="bg-white sombra-negra rounded-xl overflow-hidden border border-gray-200">
    {% if pedidos %} 
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-[#a8ae63]">
                <tr>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-extrabold text-black uppercase tracking-wider">
                        ID Pedido
                    </th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-extrabold text-black uppercase tracking-wider">
                        Usuario
                    </th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-extrabold text-black uppercase tracking-wider">
                        Fecha
                    </th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-extrabold text-black uppercase tracking-wider">
                        Estado
                    </th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-extrabold text-black uppercase tracking-wider">
                        Pago
                    </th>
                    <th scope="col" class="px-6 py-4 text-right text-xs font-extrabold text-black uppercase tracking-wider">
                        Total
                    </th>
                    <th scope="col" class="px-6 py-4 text-right text-xs font-extrabold text-black uppercase tracking-wider">
                        Acciones
                    </th>
                </tr>
            </thead>
            
            <tbody class="bg-white divide-y divide-gray-200">
                {% for pedido in pedidos %}
                <tr data-pedido-id="{{ pedido.pk }}" class="hover:bg-yellow-50 transition duration-150">
                    
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                        #{{ pedido.pk }}
                    </td>

                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800">
                        <span class="font-semibold">
                            {% if pedido.usuario_cliente and pedido.usuario_cliente.usuario %}
                                {{ pedido.usuario_cliente.usuario.get_full_name }}
                            {% else %}
                                {{ pedido.correo_electronico|default:"Usuario anónimo" }} <span class="text-gray-500 italic">(Invitado)</span>
                            {% endif %}
                        </span>
                    </td>

                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                        {{ pedido.fecha_creacion|date:"d M Y H:i" }}
                    </td>
                    
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold">
                        {% if pedido.estado == 'Pendiente' %}
                            <span class="px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">
                                {{ pedido.estado }}
                            </span>
                        {% elif pedido.estado == 'Enviado' %}
                            <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">
                                {{ pedido.estado }}
                            </span>
                        {% elif pedido.estado == 'Completado' %}
                            <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">
                                {{ pedido.estado }}
                            </span>
                        {% else %}
                            <span class="px-2 py-1 text-xs rounded-full bg-red-100 text-red-800">
                                {{ pedido.estado }}
                            </span>
                        {% endif %}
                    </td>

                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold">
                        {% if pedido.pago %}
                            <span class="px-2 py-1 text-xs rounded-full bg-green-500 text-white shadow-md">
                                Pagado
                            </span>
                        {% else %}
                            <span class="px-2 py-1 text-xs rounded-full bg-red-500 text-white shadow-md">
                                No Pagado
                            </span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-bold text-[#6a760c]">
                        {{ pedido.total_importe|default:0.00|floatformat:2 }}€
                    </td>

                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <a href="{% url 'detalle_pedido' pk=pedido.pk %}" 
                            class="text-indigo-600 hover:text-indigo-900 transition font-semibold">
                            Ver Detalle
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="p-8 text-center">
        <p class="text-gray-500 text-lg">No hay pedidos registrados.</p>
        <p class="text-gray-500">¡Espera a que los clientes realicen sus compras!</p>
    </div>
    {% endif %}
</div>
{% endblock content %}

{% block extra_js %}
<style>
    /* CLASE NUEVA PARA LA SOMBRA NEGRA */
    .sombra-negra {
        /* Desplazamiento-X | Desplazamiento-Y | Difuminado | Color negro al 70% */
        box-shadow: 0px 10px 25px -5px rgba(0, 0, 0, 0.7); 
    }
</style>
{% endblock extra_js %}