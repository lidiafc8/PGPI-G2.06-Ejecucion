{% extends 'catalogo_admin/base_admin.html' %}
{% load static %}

{% block title %}Gestión de Pedidos{% endblock %}

{% block content %}
<h1 class="text-3xl font-extrabold text-black mb-4 md:mb-0">Gestión de Pedidos</h1>

<div class="bg-white shadow-xl rounded-xl overflow-hidden">
    {% if pedidos %} 
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="lm-bg-light">
            <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    ID Pedido
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Usuario
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Fecha
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Estado
                </th>
                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Total
                </th>
                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Acciones
                </th>
            </tr>
        </thead>
        
        <tbody class="bg-white divide-y divide-gray-200">
            {% for pedido in pedidos %}
            <tr data-pedido-id="{{ pedido.pk }}">
                
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                    #{{ pedido.pk }}
                </td>

                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800">
                    <span class="font-semibold">
                        {% if pedido.usuario_cliente and pedido.usuario_cliente.usuario %}
                            {{ pedido.usuario_cliente.usuario.get_full_name }}
                        {% else %}
                            {{ pedido.correo_electronico|default:"Usuario anónimo" }} {{ "(Anónimo)" }}
                        {% endif %}
                    </span>
                </td>

                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                    {{ pedido.fecha_creacion|date:"d M Y H:i" }}
                </td>
                
                <td class="px-6 py-4 whitespace-nowrap text-sm font-bold">
                    {% if pedido.estado == 'Pendiente' %}
                        <span class="text-yellow-600">{{ pedido.estado }}</span>
                    {% elif pedido.estado == 'Enviado' %}
                        <span class="text-blue-600">{{ pedido.estado }}</span>
                    {% elif pedido.estado == 'Completado' %}
                        <span class="text-green-600">{{ pedido.estado }}</span>
                    {% else %}
                        <span class="text-red-600">{{ pedido.estado }}</span>
                    {% endif %}
                </td>

                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-bold text-gray-900">
                    {{ pedido.total_importe|default:0.00|floatformat:2 }}€
                </td>

                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <a href="{% url 'detalle_pedido' pk=pedido.pk %}" 
                        class="lm-text-green hover:underline transition">
                        Ver Detalle
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="p-8 text-center">
        <p class="text-gray-500 text-lg">No hay pedidos registrados.</p>
        <p class="text-gray-500">¡Espera a que los clientes realicen sus compras!</p>
    </div>
    {% endif %}
</div>
{% endblock content %}

{% block extra_js %}
{% endblock extra_js %}