{% extends "base.html" %}
{% block breadcrumbs %}
    </li>
    
    <li>
        <span class="text-lg text-gray-500">></span>
        <span class="text- font-medium text-gray-500 hover:text-[#bf7149]">
            {{ categoria_actual }}
        </span>
    </li>
{% endblock breadcrumbs %}

{% load static %}
{% block content %}
<main class="py-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <h1 class="text-4xl font-extrabold text-gray-900 mb-4">
            {{ categoria_actual }}      
        </h1>
        
        <hr class="mb-8">

        {% if productos_destacados %}
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6 xl:gap-8">
                
                {% for producto in productos_destacados %}
                
                    <a href="{% url 'detalle_producto' pk=producto.pk %}" 
                       class="block bg-white rounded-lg p-3 flex flex-col items-center justify-between transition duration-300 ease-in-out transform hover:shadow-hard-halo hover:scale-[1.02]">
                        
                        <div>
                           {% if producto.imagen %}
    <div class="relative w-full h-32 mb-4 flex justify-center items-center">
        <img src="{{ producto.imagen.url }}" alt="Imagen de {{ producto.nombre }}" 
             class="max-h-full max-w-full object-contain mix-blend-multiply">
        
        {% if producto.stock <= 0 %}
        <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
            <span class="bg-red-500 text-white text-base font-bold text-center uppercase tracking-wider py-1 px-4 transform -rotate-45 whitespace-nowrap">
                AGOTADO
            </span>
        </div>
        {% endif %}
    </div>
{% else %}
    <div class="relative w-full h-32 mb-4 flex justify-center items-center">
<img src="{% static 'imagen1.jpg' %}" alt="Imagen por defecto"
                                         class="max-h-full max-w-full object-contain mix-blend-multiply">
                                </div>        
        {% if producto.stock <= 0 %}
        <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
            <span class="bg-red-500 text-white text-base font-bold text-center uppercase tracking-wider py-1 px-4 transform -rotate-45 whitespace-nowrap">
                AGOTADO
            </span>
        </div>
        {% endif %}
    </div>
{% endif %}
                    

                        </div>

                        <div class="w-full text-center flex-grow flex flex-col justify-end">
                            
                            <h4 class="text-sm font-bold uppercase text-gray-900 leading-tight mb-1 line-clamp-2">
                                {{ producto.nombre|upper }}
                            </h4>
                            
                            <p class="text-xs text-gray-500 mb-2">
                                Fabricante: {{ producto.fabricante }}
                            </p>
                            
                            <div class="mb-3">
                                {% if producto.stock > 0 %}
                                    <span class="text-sm font-semibold text-[#6a760c]">
                                        {{ producto.stock }} unidades en stock
                                    </span>
                                {% else %}
                                    <span class="text-sm font-semibold text-red-600">
                                        Sin stock
                                    </span>
                                {% endif %}
                            </div>
                            
                            <span class="text-4xl font-bold mb-4 text-[#A91B0D]">
                                {{ producto.precio|floatformat:0}},<span class="text-2xl">{{ producto.precio|floatformat:2|slice:"-2:" }}€</span>
                            </span>
                        </div>
                        
                        <button onclick="event.stopPropagation(); window.location.href='/añadir-al-carrito/{{ producto.pk }}';" 
                                class="w-full py-2 bg-[#bf7149] text-white font-semibold rounded-md hover:bg-yellow-600 transition duration-150 shadow-md relative z-10 mt-2">
                            Añadir a la Cesta
                        </button>
                    </a>
                    {% endfor %}
                
            </div>
        {% else %}
            <div class="p-6 bg-[#f9fdf2] border-l-4 border-[#bf7149] text-[#bf7149] rounded-lg">
                <p class="font-semibold">¡Lo sentimos!</p>
                <p>Actualmente no hay productos disponibles en esta subcategoría.</p>
            </div>
        {% endif %}

    </div>
</main>
{% endblock content %}

{% block extra_css %}
<style>
    /* ... (Estilos existentes) ... */
    .hover\:shadow-hard-halo:hover {
        box-shadow: 0 0 15px rgba(39, 43, 4, 0.4); 
    }
    .lm-text-green { 
        color: #6a760c; 
    }
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
{% endblock extra_css %}